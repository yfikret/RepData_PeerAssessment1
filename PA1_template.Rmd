---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---


## Loading and preprocessing the data

```{r cache = TRUE}
unzip("activity.zip")
activity <- read.csv("activity.csv")
```


## What is mean total number of steps taken per day?


```{r eval = FALSE, echo = FALSE}
library(plyr)
ddply(activity, .(date), summarize, mean = round(mean(steps, na.rm = T), 2),total = sum(steps, na.rm = T))
```

```{r message=FALSE, warning=FALSE}
library(dplyr)

grouped_activity <- group_by(activity, date) 
daily_activity <- summarize(grouped_activity, 
          mean = mean(steps, na.rm = TRUE), 
          total = sum(steps, na.rm = T) 
          )
```

```{r}
steps_mean <- mean(daily_activity$mean, na.rm = T)
steps_median <- median(daily_activity$mean, na.rm = T)

#steps_mean <- round(steps_mean, digits = 3) 
#steps_median <- round(steps_median, digits = 3) 
```
The mean number of steps taken is  `r steps_mean`

The median number of steps taken is `r steps_median`

```{r echo = FALSE}
hist(daily_activity$mean, main = "Daily steps", xlab = "Total steps per day")
```


## What is the average daily activity pattern?
```{r}
grouped_activity <- group_by(activity, interval) 
interval_activity <- summarize(grouped_activity, 
          interval_mean = mean(steps, na.rm = TRUE) )

with(interval_activity, plot(interval, interval_mean, type = "l",
                    main = "Interval steps taken", 
                    xlab = "5 minute interval index", ylab = "Average steps") )
```

```{r}
max_interval <- interval_activity$interval[which.max(interval_activity$interval_mean)]
```

The interval that has the highest number of steps on average is interval `r max_interval`



## Imputing missing values
```{r}
total_nas <- sum(is.na(activity$steps))
```

The total NA values are `r total_nas`

Imputing using the average for that interval across all days
```{r}

for(index in seq_along(activity$steps)) {
  if (is.na(activity$steps[index]) ) {
    interval_mean_index <- which(activity$interval[index] == interval_activity$interval)
    interval_mean <- interval_activity$interval_mean[interval_mean_index]
    activity$steps[index] = interval_mean
  }
 
}

```


```{r }

grouped_activity <- group_by(activity, date) 
daily_activity <- summarize(grouped_activity, 
          mean = mean(steps, na.rm = TRUE), 
          total = sum(steps, na.rm = T) 
          )
```

```{r}
steps_mean <- mean(daily_activity$mean, na.rm = T)
steps_median <- median(daily_activity$mean, na.rm = T)

```
The mean number of steps taken is  `r steps_mean`

The median number of steps taken is `r steps_median`

```{r echo = FALSE}
hist(daily_activity$mean, main = "Daily steps", xlab = "Total steps per day")
```


## Are there differences in activity patterns between weekdays and weekends?



```{r}
activity$date <- as.Date(activity$date)

activity_weekdays <- weekdays(activity$date)
weekday_factor <- as.factor(ifelse(activity_weekdays %in% c("Saturday", "Sunday"), "weekend", "weekday"))

activity$weekday <- weekday_factor

weekend_activity <- activity[activity$weekday == "weekend",]

weekday_activity <- activity[activity$weekday == "weekday",]

#mean(weekday_activity$steps)
#mean(weekend_activity$steps)

grouped_weekend_activity <- group_by(weekend_activity, interval) 
averaged_weekend_activity <- summarize(grouped_weekend_activity, 
                                      interval_mean = mean(steps, na.rm = TRUE),
                                      weekday = "weekend")

grouped_weekday_activity <- group_by(weekday_activity, interval) 
averaged_weekday_activity <- summarize(grouped_weekday_activity, 
                                      interval_mean = mean(steps, na.rm = TRUE),
                                       weekday = "weekday")

averaged_data <- bind_rows(averaged_weekend_activity, averaged_weekday_activity)
averaged_data$weekday <- as.factor(averaged_data$weekday)
library(lattice)
xyplot(interval_mean ~ interval | weekday, data = averaged_data, type="l", layout = c(1, 2), xlab = "Interval", ylab = "Steps", main = "Weekend vs Weekday Activity")

```

On average, the weekend activity is higher, but weekday activity has a higher spike earlier in the day.

## Notes

```{r eval=F, echo=F}

daily_means <- lapply(activity$date, function(elt) {daily_activity$mean[which(elt == daily_activity$date, arr.ind = T)]})

activity <- mutate(activity, 
                  daily_mean = daily_means)

with(activity, plot(interval, daily_mean, 
                    main = "Interval steps taken", 
                    xlab = "5 minute interval index", ylab = "Average daily steps") 
)
```
